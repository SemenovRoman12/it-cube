<div class="modal-overlay" (click)="onClose()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Редактировать пользователя</h2>
      <button class="modal-close-btn" (click)="onClose()" type="button">
        <span>&times;</span>
      </button>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="modal-form">
      <div class="form-group">
        <label for="email" class="form-label">Email / Логин</label>
        <input
          id="email"
          type="text"
          formControlName="email"
          class="form-input"
          [class.is-invalid]="form.get('email')!.invalid && form.get('email')!.touched"
          placeholder="Введите email или логин"
        />
        @if (form.get('email')!.invalid && form.get('email')!.touched) {
          <span class="form-error">
            @if (form.get('email')!.errors?.['required']) {
              Поле обязательно для заполнения
            } @else if (form.get('email')!.errors?.['minlength']) {
              Минимум 3 символа
            }
          </span>
        }
      </div>

      <div class="form-group">
        <label for="password" class="form-label">Пароль <span class="optional">(оставьте пустым, чтобы не менять)</span></label>
        <input
          id="password"
          type="password"
          formControlName="password"
          class="form-input"
          placeholder="Новый пароль"
        />
      </div>

      <div class="form-group">
        <label for="role" class="form-label">Роль</label>
        <select
          id="role"
          formControlName="role"
          class="form-select"
          [class.is-invalid]="form.get('role')!.invalid && form.get('role')!.touched"
        >
          <option value="user">Пользователь</option>
          <option value="teacher">Учитель</option>
          <option value="admin">Администратор</option>
        </select>
        @if (form.get('role')!.invalid && form.get('role')!.touched) {
          <span class="form-error">Выберите роль</span>
        }
      </div>

      @if (errorMessage) {
        <div class="alert-error">{{ errorMessage }}</div>
      }

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="onClose()">Отмена</button>
        <button type="submit" class="btn btn-primary" [disabled]="isLoading">
          @if (isLoading) {
            <span class="spinner"></span> Сохранение...
          } @else {
            Сохранить
          }
        </button>
      </div>
    </form>
  </div>
</div>
